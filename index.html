<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>æ¾æœ¬ä¼šè¨ˆãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚¿ãƒ«</title>
<meta name="description" content="æ¾æœ¬ä¼šè¨ˆã®ç¤¾å†…å¤–å‘ã‘ãƒ„ãƒ¼ãƒ«ã‚’ä¸€ç”»é¢ã«é›†ç´„ã€‚é»’å­—çµŒå–¶4WDã¨å„ç¨®ä¾¿åˆ©ãƒ„ãƒ¼ãƒ«ã€‚" />
<link rel="icon" type="image/png" sizes="192x192" href="./favicon192192.png" />
<link rel="shortcut icon" type="image/png" href="./favicon192192.png" />
<link rel="apple-touch-icon" sizes="192x192" href="./favicon192192.png" />
<style>
  :root{ --brand:#578899; --brand-700:#456d77; --brand-300:#7aa5b4; --ink:#0f172a; --muted:#64748b; --bg:#f8fafc; --card:#ffffff; --line:#e2e8f0; --shadow:0 8px 24px rgba(15,23,42,.08); --radius:18px; }
  html,body{height:100%;}
  body{margin:0; background:var(--bg); color:var(--ink); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; line-height:1.55;}

  /* ---- Hero ---- */
  .hero{position:relative; background: linear-gradient(180deg, #ffffff 0%, #f3f7fb 100%); padding: 16px 16px 12px; border-bottom:1px solid var(--line);} 
  .hero .topbar{display:flex; align-items:center; justify-content:space-between; gap:10px; max-width:1100px; margin:0 auto;}
  .branding{display:flex; align-items:center; gap:10px;}
  .logo{width:50px;height:50px;border-radius:10px;overflow:hidden;display:grid;place-items:center;text-decoration:none;flex-shrink:0;}
  .logo img{width:100%;height:100%;object-fit:contain;display:block;}
  .title{font-size: clamp(16px,2vw,24px); font-weight:800; line-height:1.3;}
  .subtitle{color:var(--muted); font-size: clamp(11px,1.8vw,14px); line-height:1.3;} 

  /* ---- Sections ---- */
  .section{max-width:1100px; margin:12px auto; padding:0 16px;}
  .section h2{display:flex; align-items:center; gap:8px; font-size: clamp(16px,2.2vw,24px); margin:12px 0 8px; font-weight:900; color:var(--brand-700);} 
  .desc{color:var(--muted); font-size:13px; margin:0 0 4px; line-height:1.4;}

  /* ---- Link tiles ---- */
  .linklist{display:grid; gap:10px;}
  .tile{display:flex; align-items:center; gap:10px; padding:10px 12px; background:var(--card); border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow); text-decoration:none; color:var(--ink);} 
  .tile:hover{background:#fdfefe; border-color:#d7e2ea;}
  .badge{width:36px; height:36px; border-radius:10px; display:grid; place-items:center; background:linear-gradient(135deg, var(--brand) 0%, var(--brand-300) 100%); color:#fff; font-weight:800; flex:0 0 auto;}
  .badge svg{width:20px; height:20px; stroke:#fff; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round;}
  .tile .ttext{display:flex; flex-direction:column; gap:2px;}
  .tile .ttext .title{font-size:15px; font-weight:800;}
  .tile .ttext .desc{font-size:12px; color:var(--muted); margin:0;}

  /* ---- 4WD layout (car) ---- */
  .layout-top{display:block;}
  .wheel{position:relative;margin:0 auto;width:min(420px,92vw);aspect-ratio:1/1;}
  .hub{position:absolute;top:50%;left:50%;translate:-50% -50%;width:clamp(260px,46vw,420px);height:clamp(260px,46vw,420px);} 
  .hub img.carimg{width:100%;height:100%;object-fit:contain;display:block !important;}

  .wheel .corner{position:absolute;display:inline-flex;align-items:center;gap:6px;text-decoration:none;background:#fff;border:1px solid var(--line);color:var(--brand-700);font-weight:800;padding:6px 10px;border-radius:999px;box-shadow:var(--shadow);font-size:14px; white-space:nowrap; z-index:10;} 
  .mini-badge{width:20px;height:20px;border-radius:6px;display:grid;place-items:center;background:linear-gradient(135deg, var(--brand) 0%, var(--brand-300) 100%);color:#fff;font-size:11px;font-weight:800; flex-shrink:0;}
  .mini-badge svg{width:12px;height:12px; stroke:#fff; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round;}

  .tiles4{display:grid; gap:10px;}

  /* ---- NEW: Quick start + flows ---- */
  .h3{margin:10px 0 6px; font-size:14px; font-weight:900; color:var(--brand-700);} 
  .start-grid{display:grid; gap:10px;}
  .tile-btn{cursor:pointer;}
  button.tile{width:100%; text-align:left;}
  button.tile{appearance:none; -webkit-appearance:none; border:1px solid var(--line);} 
  .flow-grid{display:grid; gap:10px; margin-top:8px;}
  .flow-card{background:var(--card); border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow); padding:10px 12px;}
  .flow-title{font-weight:900; color:var(--ink); margin:0 0 6px; display:flex; align-items:center; justify-content:space-between; gap:8px;}
  .kpi{display:inline-flex; align-items:center; gap:6px; font-size:11px; color:var(--brand-700); background:#f3f7fb; border:1px solid #dbe7ee; padding:2px 8px; border-radius:999px; font-weight:800; white-space:nowrap;}
  .flow-steps{display:flex; flex-wrap:wrap; align-items:center; gap:6px; margin:0;}
  .chip{display:inline-flex; align-items:center; gap:6px; text-decoration:none; font-weight:800; font-size:12px; color:var(--brand-700); background:#fff; border:1px solid #dbe7ee; padding:6px 10px; border-radius:999px;}
  .chip:hover{background:#fbfdff; border-color:#cfe0ea;}
  .arrow{color:var(--muted); font-weight:900;}
  .flow-note{margin:6px 0 0; font-size:12px; color:var(--muted); line-height:1.4;}

  /* NEW: collapsible start panel (closed by default) */
  .collapse{max-height:0; overflow:hidden; transition:max-height .25s ease;}

  /* ======= Desktop (PC) ======= */
  @media (min-width:1024px){
    .hero{padding: 24px 16px 16px;}
    .section{margin:18px auto;}
    .section h2{margin:18px 0 10px;}
    .desc{font-size:14px; margin:0 0 8px;}
    .linklist{gap:12px;}
    .tile{gap:12px; padding:12px 14px;}
    .badge{width:38px; height:38px;}
    .tile .ttext{gap:4px;}
    .tile .ttext .title{font-size:16px;}
    .tile .ttext .desc{font-size:13px;}
    .wheel{margin:8px auto;}

    /* ä¸Šæ®µï¼šå·¦=è»Šã€å³=PLãƒªãƒ³ã‚¯ï¼ˆ4WDãƒªãƒ³ã‚¯ã¯ä¸€æ®µä¸‹ã’ã¦ãƒ•ãƒ«å¹…ï¼‰ */
    .layout-top{display:grid; grid-template-columns: 340px 1fr; grid-template-areas: "wheel pl"; align-items:center; gap:16px;}
    .wheel{grid-area: wheel; width:340px;}
    .hub{width:220px;height:220px;}
    #shitenno .wheel .corner.tl{top:18%; left:10%;}
    #shitenno .wheel .corner.tr{top:18%; right:10%;}
    #shitenno .wheel .corner.bl{bottom:18%; left:10%;}
    #shitenno .wheel .corner.br{bottom:18%; right:10%;}
    .wheel .corner{gap:8px; padding:8px 10px;}

    .pllink{grid-area: pl;}
    .tiles4-row{grid-template-columns: repeat(4, 1fr);} 
    .tiles4{gap:12px;}

    /* NEW */
    .start-grid{grid-template-columns: 1fr 1fr 1fr;}
    .flow-grid{grid-template-columns: 1fr 1fr;}
  }

  /* ======= Mobileï¼ˆã‚¹ãƒãƒ›ï¼‰ ======= */
  @media (max-width:767px){
    .hero { padding-bottom: 8px; }
    .section { margin-top: 8px; margin-bottom: 8px;}
    .section h2 { margin-top: 0; margin-bottom: 4px; font-size: 18px; }
    .desc { margin-bottom: 0; font-size: 12px; }

    .wheel { width: min(280px, 85vw); margin: -16px auto -16px; }
    .hub { width: 52%; height: 52%; }

    #shitenno .wheel .corner.tl{top:22%; left:4%;}
    #shitenno .wheel .corner.tr{top:22%; right:4%;}
    #shitenno .wheel .corner.bl{bottom:22%; left:4%;}
    #shitenno .wheel .corner.br{bottom:22%; right:4%;}

    .wheel .corner { font-size: 11px; padding: 4px 8px; gap: 4px; height: 28px; border-radius: 14px; box-shadow: 0 2px 8px rgba(15,23,42,.12); }
    .mini-badge { width: 18px; height: 18px; border-radius: 5px; }
    .mini-badge svg { width: 11px; height: 11px; }

    .wheel .corner.oncar { font-size: 11px; padding: 4px 8px; }
    .pllink{margin: 0 0 10px 0;} 

    .tiles4-row{grid-template-columns: 1fr;}
    .card{min-height:auto;}

    .branding img{height:40px;}
    .logo{width:44px; height:44px;}
    .title{font-size: 17px;}

    /* NEW */
    .h3{margin-top:8px;}
  }

  /* ======= Tablet (768-1023px) ======= */
  @media (min-width:768px) and (max-width:1023px){
    #shitenno .wheel .corner.tl{top:26%; left:14%;}
    #shitenno .wheel .corner.tr{top:26%; right:14%;}
    #shitenno .wheel .corner.bl{bottom:26%; left:14%;}
    #shitenno .wheel .corner.br{bottom:26%; right:14%;}

    /* NEW */
    .start-grid{grid-template-columns: 1fr 1fr;}
    .flow-grid{grid-template-columns: 1fr;}
  }

  /* ---- Footer ---- */
  footer{border-top:1px solid var(--line); padding:16px; color:var(--muted); text-align:center;}
  .credit-link{color:inherit;text-decoration:underline;text-underline-offset:2px;} 
  .wheel .corner.oncar{top:50%;left:50%;transform:translate(-50%,-50%);z-index:2;}

  /* Header actions & button */
  .actions{display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end;}
  .btn{border:1px solid var(--line); background:#fff; color:var(--brand-700); border-radius:12px; padding:8px 12px; font-weight:700; cursor:pointer; box-shadow:var(--shadow);} 
  .btn:hover{background:#fefefe;}
  .actions .btn{display:inline-flex; align-items:center; justify-content:center; height:36px; padding:0 12px;}
  .actions .btn.compact{height:36px; padding:0 10px; font-size:12px; border-radius:12px;}
  .btn .label-full, .btn .label-short{white-space:nowrap;}

  /* QR modal */
  .modal{position:fixed; inset:0; background:rgba(15,23,42,.5); display:none; align-items:center; justify-content:center; z-index:50;}
  .modal.show{display:flex;}
  .modal .modal-body{position:relative; background:#fff; border-radius:18px; padding:12px; max-width:min(92vw,560px); box-shadow:var(--shadow);} 
  .modal .modal-body img{display:block; width:100%; height:auto;}
  .modal .btn.close{position:absolute; top:8px; right:8px; padding:6px 10px; border-radius:999px;}

  /* NEW: Diagnosis modal UI */
  .modal-body .modal-title{font-weight:900; font-size:16px; margin:4px 0 8px; color:var(--ink);} 
  .form{display:grid; gap:10px;}
  .fieldset{border:1px solid var(--line); border-radius:14px; padding:10px;}
  .legend{font-weight:900; color:var(--brand-700); font-size:13px;}
  .opt{display:flex; align-items:flex-start; gap:10px; padding:8px; border-radius:12px;}
  .opt:hover{background:#f8fafc;}
  .opt input{margin-top:3px;}
  .opt .olabel{display:flex; flex-direction:column; gap:2px;}
  .opt .olabel .t{font-weight:900;}
  .opt .olabel .d{font-size:12px; color:var(--muted);}
  .diag-actions{display:flex; gap:8px; justify-content:flex-end; align-items:center; margin-top:10px;}
  .btn.primary{background:linear-gradient(135deg, var(--brand) 0%, var(--brand-300) 100%); color:#fff; border-color:transparent;}
  .btn.primary:hover{filter:brightness(1.02);} 
  .result{margin-top:10px; border-top:1px dashed #dbe7ee; padding-top:10px;}
  .result .rtitle{font-weight:900; margin:0 0 6px;}
  .result .rsteps{display:flex; flex-wrap:wrap; align-items:center; gap:6px; margin:0;}
  .result .rnote{margin:6px 0 0; color:var(--muted); font-size:12px;}

  /* ç”»åƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä¿è­· */
  img{max-width:100%; height:auto;}

  /* ã‚¹ãƒãƒ›ã®å¤§ããªå†™çœŸï¼ˆãƒ’ãƒ¼ãƒ­ãƒ¼ç­‰ï¼‰ãŒã¯ã¿å‡ºã—ãŸã‚Šç´°é•·ããªã‚‰ãªã„ã‚ˆã†ã«ãƒˆãƒªãƒŸãƒ³ã‚° */
  @media (max-width:767px){
    .photo-frame, .hero-photo, .cover-photo, .kv{ position:relative; width:100%; aspect-ratio: 4 / 3; border-radius:16px; overflow:hidden; background:#eef3f7; }
    .photo-frame>img, .hero-photo>img, .cover-photo>img, .kv>img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; object-position:center; }
  }

  /* ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒœã‚¿ãƒ³ */
  .btn.compact{font-size:12px; padding:6px 10px; border-radius:10px;}

  /* ãƒ©ãƒ™ãƒ«ã®å¯å¤‰è¡¨ç¤ºï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ•ãƒ«ã€ã‚¹ãƒãƒ›ã¯çŸ­ç¸® */
  .btn .label-short{display:none;}
  @media (max-width:767px){
    .btn .label-full{display:none;}
    .btn .label-short{display:inline;}
  }

  /* PCæ™‚ã®ã¿ A2HSç”»åƒãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å°‘ã—å¤§ãã */
  @media (min-width:1024px){
    #a2hs-modal .modal-body{max-width:min(92vw, 720px);} 
    #diag-modal .modal-body{max-width:min(92vw, 720px);} 
  }

  /* --- Minimal, CCå¯¾å¿œã®ãƒ•ãƒƒã‚¿ãƒ¼ --- */
  .mk-mini{font-size:12px; line-height:1.4; color:var(--muted); text-align:center; padding:8px 12px; border-top:1px solid var(--line);} 
  .mk-mini a{color:inherit; text-decoration:underline; text-underline-offset:2px;}
  @media (max-width:480px){ .mk-mini{ font-size:11px; } }

  /* PC: 4WDæ¨ªä¸¦ã³ã®å„ã‚¿ã‚¤ãƒˆãƒ«ã‚’1è¡ŒåŒ–ï¼ˆé•·æ–‡å¯¾ç­–ï¼‰ */
  @media (min-width: 1024px){
    #shitenno .tiles4-row .tile .ttext{min-width:0;}
    #shitenno .tiles4-row .tile .ttext .title{ font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; display:block; }
  }

  /* ã‚¹ãƒãƒ›èƒŒæ™¯è‰²ã¨ãƒ­ã‚´ã‚µã‚¤ã‚ºèª¿æ•´ */
  .branding img{height:56px; width:auto; display:block;}
  @media (max-width:480px){ .branding img{height:48px;} }
  @media (max-width:767px){ body{ background:#f7fafc; } }
</style>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-91JF4BT2QT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);} 
  gtag('js', new Date());
  gtag('config', 'G-91JF4BT2QT');
</script>
</head>
<body>
  <header class="hero">
    <div class="topbar">
      <div class="branding">
        <a class="logo" href="https://www.matsumoto-kaikei.or.jp/" target="_blank" rel="noopener" aria-label="ç¨ç†å£«æ³•äººæ¾æœ¬ä¼šè¨ˆäº‹å‹™æ‰€ å…¬å¼ã‚µã‚¤ãƒˆ"><img src="./ãƒ­ã‚´.jpg" onerror="this.onerror=null;this.src='./ãƒ­ã‚´.png'" alt="æ¾æœ¬ä¼šè¨ˆãƒ­ã‚´"></a>
        <div>
          <div class="title">æ¾æœ¬ä¼šè¨ˆãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚¿ãƒ«</div>
          <div class="subtitle">é»’å­—çµŒå–¶ã‚’åŠ é€Ÿã™ã‚‹ã€æ¾æœ¬ä¼šè¨ˆã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ„ãƒ¼ãƒ«é›†</div>
        </div>
      </div>
      <div class="actions">
        <button id="start-toggle" class="btn compact" aria-controls="start-panel" aria-expanded="false"><span class="label-full" id="start-label">ã¾ãšã¯ã“ã“ã‹ã‚‰</span><span class="label-short" id="start-label-s">å…¥å£</span></button>
        <button id="qr-open" class="btn"><span class="label-full">å…±æœ‰ç”¨QR</span><span class="label-short">QR</span></button>
        <button id="a2hs-open" class="btn compact"><span class="label-full">ãƒ›ãƒ¼ãƒ ç”»é¢ã¸ã®è¿½åŠ æ–¹æ³•</span><span class="label-short">è¿½åŠ </span></button>
      </div>
    </div>
  </header>

  <!-- QRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="qr-modal" class="modal" aria-hidden="true" role="dialog" aria-label="å…±æœ‰ç”¨QRã‚³ãƒ¼ãƒ‰">
    <div class="modal-body">
      <button class="btn close" id="qr-close" aria-label="é–‰ã˜ã‚‹">âœ•</button>
      <img src="./å…±æœ‰ç”¨QR.png" alt="å…±æœ‰ç”¨QRã‚³ãƒ¼ãƒ‰" loading="lazy" />
    </div>
  </div>

  <!-- ãƒ›ãƒ¼ãƒ ç”»é¢è¿½åŠ ã‚¬ã‚¤ãƒ‰ï¼ˆPNGï¼‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="a2hs-modal" class="modal" aria-hidden="true" role="dialog" aria-label="ãƒ›ãƒ¼ãƒ ç”»é¢ã¸ã®è¿½åŠ æ–¹æ³•">
    <div class="modal-body">
      <button class="btn close" id="a2hs-close" aria-label="é–‰ã˜ã‚‹">âœ•</button>
      <img src="./ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ .png" alt="ãƒ›ãƒ¼ãƒ ç”»é¢ã¸ã®è¿½åŠ æ–¹æ³•" loading="lazy" />
    </div>
  </div>

  <!-- NEW: 3åˆ†è¨ºæ–­ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="diag-modal" class="modal" aria-hidden="true" role="dialog" aria-label="3åˆ†è¨ºæ–­">
    <div class="modal-body">
      <button class="btn close" id="diag-close" aria-label="é–‰ã˜ã‚‹">âœ•</button>
      <div class="modal-title">3åˆ†è¨ºæ–­ï¼šæœ€åˆã®1æœ¬ã¨ã€æ¬¡ã®ä¸€æ‰‹ã‚’ææ¡ˆã—ã¾ã™</div>

      <form id="diag-form" class="form">
        <div class="fieldset">
          <div class="legend">ä»Šã„ã¡ã°ã‚“è¿‘ã„ãƒ†ãƒ¼ãƒã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ</div>
          <label class="opt"><input type="radio" name="topic" value="price" checked>
            <div class="olabel"><div class="t">å€¤ä¸Šã’ãƒ»ä¾¡æ ¼æ”¹å®š</div><div class="d">ä¾¡æ ¼ã‚’ä¸Šã’ã‚‹ï¼ä¸‹ã’ã‚‹åˆ¤æ–­ææ–™ãŒæ¬²ã—ã„</div></div>
          </label>
          <label class="opt"><input type="radio" name="topic" value="cost">
            <div class="olabel"><div class="t">æ”¯å‡ºãƒ»ã‚³ã‚¹ãƒˆã®å¦¥å½“æ€§</div><div class="d">ãã®æ”¯å‡ºãŒã©ã‚Œãã‚‰ã„é‡ã„ã‹ã‚’è…¹è½ã¡ã•ã›ãŸã„</div></div>
          </label>
          <label class="opt"><input type="radio" name="topic" value="labor">
            <div class="olabel"><div class="t">äººä»¶è²»ãƒ»æ¡ç”¨ãƒ»é…ç½®</div><div class="d">æ™‚é–“å˜ä¾¡ã‚„å·¥æ•°ã‹ã‚‰ã€æ„æ€æ±ºå®šã—ãŸã„</div></div>
          </label>
          <label class="opt"><input type="radio" name="topic" value="auto">
            <div class="olabel"><div class="t">DXãƒ»è‡ªå‹•åŒ–æŠ•è³‡</div><div class="d">åˆæœŸè²»ãƒ»æœˆé¡ã«è¦‹åˆã†ã‹ã‚’è¦‹ãŸã„</div></div>
          </label>
          <label class="opt"><input type="radio" name="topic" value="cash">
            <div class="olabel"><div class="t">è³‡é‡‘ç¹°ã‚Šï¼ˆå›è»¢ï¼‰</div><div class="d">å£²ä¸ŠãŒã‚ã‚‹ã®ã«è³‡é‡‘ãŒæ®‹ã‚‰ãªã„åŸå› ã‚’ç‰¹å®šã—ãŸã„</div></div>
          </label>
          <label class="opt"><input type="radio" name="topic" value="tax">
            <div class="olabel"><div class="t">ç¨å‹™ãƒ»å®Ÿå‹™ï¼ˆä»•è¨³/å„Ÿå´ï¼‰</div><div class="d">å‡¦ç†åˆ¤æ–­ã‚„è¨ˆç®—ã®æ™‚çŸ­ã‚’ã—ãŸã„</div></div>
          </label>
        </div>

        <div class="diag-actions">
          <button type="button" class="btn" id="diag-reset">ãƒªã‚»ãƒƒãƒˆ</button>
          <button type="submit" class="btn primary">çµæœã‚’è¦‹ã‚‹</button>
        </div>

        <div id="diag-result" class="result" hidden>
          <div class="rtitle">ãŠã™ã™ã‚ã®é †ç•ª</div>
          <div class="rsteps" id="diag-steps"></div>
          <p class="rnote">å„ã‚¹ãƒ†ãƒƒãƒ—ã‚’é †ã«é–‹ã„ã¦ã€çµæœã‚’è¦‹ãªãŒã‚‰æ¬¡ã¸é€²ã‚ã¦ãã ã•ã„ã€‚ãƒ„ãƒ¼ãƒ«ç”»é¢ã«ã¯ã€Œãƒãƒ¼ã‚¿ãƒ«ã¸æˆ»ã‚‹ã€ãƒŠãƒ“ã‚’è¿½åŠ ã™ã‚‹æƒ³å®šã§ã™ã€‚</p>
        </div>
      </form>
    </div>
  </div>

  <!-- NEW: å…¥å£ã®ã€Œä½¿ã„æ–¹ã®å‹ã€ -->
  <div id="start-panel" class="collapse" aria-hidden="true">
    <section id="start" class="section">
    <h2>ğŸ§­ ã¾ãšã¯ã“ã“ã‹ã‚‰</h2>
    <p class="desc">è¿·ã£ãŸã‚‰ã€Œ3åˆ†è¨ºæ–­ã€ã§æœ€åˆã®1æœ¬ã‚’å›ºå®šã—ã€æ¬¡ã®ä¸€æ‰‹ã¾ã§æç¤ºã—ã¾ã™ã€‚é¢è«‡ãƒ»ç¤¾å†…æ¤œè¨ã®å°ç·šã‚’ä½œã‚‹ç›®çš„ã§ã™ã€‚</p>

    <div class="start-grid" aria-label="ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ">
      <button id="diag-open" class="tile tile-btn" type="button" aria-label="3åˆ†è¨ºæ–­ã‚’é–‹ã">
        <div class="badge">3åˆ†</div>
        <div class="ttext"><div class="title">3åˆ†è¨ºæ–­ï¼ˆè¿·ã£ãŸã‚‰ã“ã¡ã‚‰ï¼‰</div><p class="desc">ç›®çš„ã‚’é¸ã¶ã ã‘ã§ã€Œæœ€åˆã®1æœ¬ã€ã¨ã€Œæ¬¡ã®ä¸€æ‰‹ã€ã‚’ææ¡ˆ</p></div>
      </button>

      <a class="tile" data-tool="sales" data-next="price" target="_blank" rel="noopener">
        <div class="badge">â–¶</div>
        <div class="ttext"><div class="title">3åˆ†ã‚¹ã‚¿ãƒ¼ãƒˆï¼šå£²ä¸Šæ›ç®—</div><p class="desc">æ”¯å‡ºã®é‡ã•ã‚’ã€Œå¿…è¦å£²ä¸Šã€ã«ç½®ãæ›ãˆã¦ã€æ„æ€æ±ºå®šã‚’æ—©ã‚ã‚‹</p></div>
      </a>

      <a class="tile" data-tool="pl" data-next="sales" target="_blank" rel="noopener">
        <div class="badge">â–¶</div>
        <div class="ttext"><div class="title">3åˆ†ã‚¹ã‚¿ãƒ¼ãƒˆï¼šå¤‰å‹•æç›Šï¼ˆãƒœãƒ¼ãƒ«ï¼‰</div><p class="desc">é™ç•Œåˆ©ç›Šã¨å›ºå®šè²»ã®é–¢ä¿‚ã‚’ã€ç›´æ„Ÿã§è…¹è½ã¡ã•ã›ã‚‹</p></div>
      </a>
    </div>

    <div class="h3">ç›®çš„åˆ¥ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</div>
    <div class="flow-grid" aria-label="ç›®çš„åˆ¥ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ">
      <div class="flow-card">
        <div class="flow-title">å€¤ä¸Šã’æ¤œè¨ <span class="kpi">ç²—åˆ©ãƒ»åˆ©ç›Š</span></div>
        <div class="flow-steps">
          <a class="chip" data-tool="price" data-next="pl" target="_blank" rel="noopener">ä¾¡æ ¼æ”¹å®š</a>
          <span class="arrow">â†’</span>
          <a class="chip" data-tool="pl" data-next="sales" target="_blank" rel="noopener">å¤‰å‹•æç›Š</a>
        </div>
        <p class="flow-note">ä¾¡æ ¼æ”¹å®šã®å½±éŸ¿ã‚’æŠŠæ¡ã—ãŸã†ãˆã§ã€åˆ©ç›Šæ§‹é€ ï¼ˆé™ç•Œåˆ©ç›Šï¼‰ã«è½ã¨ã—è¾¼ã¿ã¾ã™ã€‚</p>
      </div>

      <div class="flow-card">
        <div class="flow-title">ã‚³ã‚¹ãƒˆåˆ¤æ–­ï¼ˆæ”¯å‡ºã®å¦¥å½“æ€§ï¼‰ <span class="kpi">å¿…è¦å£²ä¸Š</span></div>
        <div class="flow-steps">
          <a class="chip" data-tool="sales" data-next="pl" target="_blank" rel="noopener">å£²ä¸Šæ›ç®—</a>
          <span class="arrow">â†’</span>
          <a class="chip" data-tool="pl" data-next="price" target="_blank" rel="noopener">å¤‰å‹•æç›Š</a>
        </div>
        <p class="flow-note">ã€Œã“ã®æ”¯å‡ºã¯ã€å£²ä¸Šã«ç›´ã™ã¨ã„ãã‚‰å¿…è¦ã‹ï¼Ÿã€ã‹ã‚‰è­°è«–ã‚’å§‹ã‚ã‚‹ã¨æ—©ã„ã§ã™ã€‚</p>
      </div>

      <div class="flow-card">
        <div class="flow-title">æ¡ç”¨ãƒ»é…ç½®ãƒ»å·¥æ•°ã®è¦‹ç›´ã— <span class="kpi">æ™‚é–“å˜ä¾¡</span></div>
        <div class="flow-steps">
          <a class="chip" data-tool="labor" data-next="sales" target="_blank" rel="noopener">äººä»¶è²»</a>
          <span class="arrow">â†’</span>
          <a class="chip" data-tool="sales" data-next="price" target="_blank" rel="noopener">å£²ä¸Šæ›ç®—</a>
        </div>
        <p class="flow-note">æ™‚é–“å˜ä¾¡ã‚’å‰æã«ã€Œã“ã®å·¥æ•°ã¯å£²ä¸Šä½•å††ç›¸å½“ã‹ã€ã‚’åˆã‚ã›ã‚‹ã¨ã€ç¾å ´ãŒå‹•ãã‚„ã™ããªã‚Šã¾ã™ã€‚</p>
      </div>

      <div class="flow-card">
        <div class="flow-title">DXãƒ»è‡ªå‹•åŒ–æŠ•è³‡ <span class="kpi">å›åãƒ»ROI</span></div>
        <div class="flow-steps">
          <a class="chip" data-tool="auto" data-next="sales" target="_blank" rel="noopener">è‡ªå‹•åŒ–åŠ¹æœ</a>
          <span class="arrow">â†’</span>
          <a class="chip" data-tool="sales" data-next="pl" target="_blank" rel="noopener">å£²ä¸Šæ›ç®—</a>
        </div>
        <p class="flow-note">å‰Šæ¸›æ™‚é–“â†’äººä»¶è²»â†’å›åæœˆæ•°â†’æ„æ€æ±ºå®šã€ã®é †ã§é¢è«‡ãŒã¾ã¨ã¾ã‚Šã¾ã™ã€‚</p>
      </div>

      <div class="flow-card">
        <div class="flow-title">è³‡é‡‘ç¹°ã‚Šï¼ˆå›è»¢ï¼‰ <span class="kpi">CCC</span></div>
        <div class="flow-steps">
          <a class="chip" data-tool="ccc" data-next="sales" target="_blank" rel="noopener">CCC</a>
          <span class="arrow">â†’</span>
          <a class="chip" data-tool="sales" data-next="price" target="_blank" rel="noopener">å£²ä¸Šæ›ç®—</a>
        </div>
        <p class="flow-note">å›è»¢ï¼ˆé‹è»¢è³‡é‡‘ã®æºœã¾ã‚Šï¼‰ã‚’ç‰¹å®šã—ãŸå¾Œã€æ‰“ã¡æ‰‹ã®å„ªå…ˆé †ä½ã‚’ã¤ã‘ã¾ã™ã€‚</p>
      </div>

      <div class="flow-card">
        <div class="flow-title">ç¨å‹™ãƒ»å®Ÿå‹™ã®æ™‚çŸ­ <span class="kpi">å‡¦ç†åŠ¹ç‡</span></div>
        <div class="flow-steps">
          <a class="chip" data-tool="withholding" data-next="dep" target="_blank" rel="noopener">æºæ³‰ãƒ»ä»•è¨³è£œåŠ©</a>
          <span class="arrow">â†’</span>
          <a class="chip" data-tool="dep" data-next="withholding" target="_blank" rel="noopener">æ¸›ä¾¡å„Ÿå´</a>
        </div>
        <p class="flow-note">è¨ˆç®—ãƒ»ä»•è¨³ã®è¿·ã„ã‚’æ¸›ã‚‰ã—ã€ç¢ºèªæ™‚é–“ã‚’çŸ­ç¸®ã—ã¾ã™ã€‚</p>
      </div>
    </div>
  </section>
  </div>

  <section id="shitenno" class="section">
    <h2>ğŸš— é»’å­—çµŒå–¶4WD</h2>
    <p class="desc">å¤‰å‹•PLï¼‹å››ã¤ã®å®Ÿå‹™ãƒ„ãƒ¼ãƒ«ã§ã€é»’å­—çµŒå–¶ã‚’é§†å‹•ã™ã‚‹ã€‚<br>ï¼ˆãˆ±TKCã®FXã‚¯ãƒ©ã‚¦ãƒ‰ã‚·ãƒªãƒ¼ã‚ºã¨ã®ä½µç”¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ï¼‰</p>

    <!-- ä¸Šæ®µï¼šå·¦ã«è»Šã€å³ã«å¤‰å‹•PLãƒªãƒ³ã‚¯ -->
    <div class="layout-top">
      <div class="wheel" aria-label="4WDé…ç½®">
        <div class="hub">
          <img class="carimg" alt="4WD car" src="./å››è¼ªé§†å‹•.png" decoding="async" loading="eager" />
        </div>

        <!-- ä¸­å¤®ï¼šå¤‰å‹•æç›Šï¼ˆå³å¯†ä¸­å¤®ï¼‰ -->
        <a class="corner oncar" data-tool="pl" data-next="sales" target="_blank" rel="noopener"><span class="mini-badge">PL</span><span>å¤‰å‹•æç›Š</span></a>

        <!-- å››è¼ªãƒãƒƒãƒ— -->
        <a class="corner tl" data-tool="sales" data-next="price" target="_blank" rel="noopener"><span class="mini-badge"><svg viewBox="0 0 24 24"><path d="M7 12h10"/><path d="M10 9l-3 3 3 3"/><path d="M14 9l3 3-3 3"/></svg></span><span>å£²ä¸Šæ›ç®—</span></a>
        <a class="corner tr" data-tool="price" data-next="pl" target="_blank" rel="noopener"><span class="mini-badge"><svg viewBox="0 0 24 24"><path d="M12 6v12"/><path d="M8 10l4-4 4 4"/><path d="M8 14l4 4 4-4"/></svg></span><span>ä¾¡æ ¼æ”¹å®š</span></a>
        <a class="corner bl" data-tool="labor" data-next="sales" target="_blank" rel="noopener"><span class="mini-badge"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 2"/></svg></span><span>äººä»¶è²»</span></a>
        <a class="corner br" data-tool="auto" data-next="sales" target="_blank" rel="noopener"><span class="mini-badge"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a8 8 0 0 0 0-6M4.6 9a8 8 0 0 0 0 6"/><path d="M12 2v2M12 20v2M2 12h2M20 12h2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M17.66 6.34l1.41-1.41M6.34 17.66l-1.41 1.41"/></svg></span><span>è‡ªå‹•åŒ–åŠ¹æœ</span></a>
      </div>

      <div class="linklist pllink">
        <a class="tile" data-tool="pl" data-next="sales" target="_blank" rel="noopener">
          <div class="badge">PL</div>
          <div class="ttext"><div class="title">ãƒœãƒ¼ãƒ«ã§å­¦ã¶å¤‰å‹•æç›Šè¨ˆç®—æ›¸</div><p class="desc">å£²ä¸Šé«˜ã¨é™ç•Œåˆ©ç›Šã€å›ºå®šè²»ã®é–¢ä¿‚ã‚’ç›´æ„Ÿçš„ã«ç†è§£</p></div>
        </a>
      </div>
    </div>

    <!-- ä¸€æ®µä¸‹ã’ï¼š4WDã®4ãƒªãƒ³ã‚¯ -->
    <div class="tiles4 tiles4-row" aria-label="4WDã®å„ãƒ„ãƒ¼ãƒ«">
      <a class="tile" data-tool="sales" data-next="price" target="_blank" rel="noopener">
        <div class="badge"><svg viewBox="0 0 24 24"><path d="M7 12h10"/><path d="M10 9l-3 3 3 3"/><path d="M14 9l3 3-3 3"/></svg></div>
        <div class="ttext"><div class="title">ãã‚Œã€å£²ä¸Šã«ç›´ã™ã¨ã„ãã‚‰ã§ã™ã‹ï¼Ÿ</div><p class="desc">æ”¯å‡ºé¡ã‚’å¿…è¦å£²ä¸Šé‡‘é¡ã«å³æ›ç®—</p></div>
      </a>
      <a class="tile" data-tool="price" data-next="pl" target="_blank" rel="noopener">
        <div class="badge"><svg viewBox="0 0 24 24"><path d="M12 6v12"/><path d="M8 10l4-4 4 4"/><path d="M8 14l4 4 4-4"/></svg></div>
        <div class="ttext"><div class="title">ä¾¡æ ¼æ”¹å®šæ¤œè¨ãƒ„ãƒ¼ãƒ«</div><p class="desc">ä¾¡æ ¼æ”¹å®šã®å½±éŸ¿ã‚’è©¦ç®—</p></div>
      </a>
      <a class="tile" data-tool="labor" data-next="sales" target="_blank" rel="noopener">
        <div class="badge">Â¥</div>
        <div class="ttext"><div class="title">äººä»¶è²»è¦‹ãˆã‚‹åŒ–ãƒ„ãƒ¼ãƒ«</div><p class="desc">æ™‚é–“å˜ä¾¡ã§äººä»¶è²»ã‚’å¯è¦–åŒ–</p></div>
      </a>
      <a class="tile" data-tool="auto" data-next="sales" target="_blank" rel="noopener">
        <div class="badge">âš™ï¸</div>
        <div class="ttext"><div class="title">è‡ªå‹•åŒ–åŠ¹æœè©¦ç®—ãƒ„ãƒ¼ãƒ«</div><p class="desc">è‡ªå‹•åŒ–ã®æŠ•è³‡å¯¾åŠ¹æœã‚’è©¦ç®—</p></div>
      </a>
    </div>
  </section>

  <section id="others" class="section">
    <h2>ğŸ§° ãã®ä»–ä¾¿åˆ©ãƒ„ãƒ¼ãƒ«</h2>
    <div class="tiles4">
      <a class="tile" data-tool="withholding" data-next="dep" target="_blank" rel="noopener">
        <div class="badge">%</div>
        <div class="ttext"><div class="title">å—å–åˆ©æ¯ãƒ»é…å½“é‡‘ ä»•è¨³è£œåŠ©</div><p class="desc">æ‰‹å–é¡ã‹ã‚‰æºæ³‰å¾´åç¨é¡ã‚’é€†ç®—ãƒ»ä»•è¨³ã‚’è¡¨ç¤º</p></div>
      </a>
      <a class="tile" data-tool="dep" data-next="withholding" target="_blank" rel="noopener">
        <div class="badge">Î£</div>
        <div class="ttext"><div class="title">æ¸›ä¾¡å„Ÿå´è²»è¨ˆç®—ãƒ„ãƒ¼ãƒ«</div><p class="desc">å®šé¡æ³•ãƒ»å®šç‡æ³•ã®å„Ÿå´è²»ã‚’å³æ™‚è¨ˆç®—</p></div>
      </a>
      <a class="tile" data-tool="insurance" data-next="sales" target="_blank" rel="noopener">
        <div class="badge"><svg viewBox="0 0 24 24"><path d="M12 2l7 4v6c0 5-3 9-7 10-4-1-7-5-7-10V6l7-4z"/></svg></div>
        <div class="ttext"><div class="title">æ¨™æº–ä¿éšœé¡ãƒ»ä¿é™ºæ–™æ›ç®—ãƒ„ãƒ¼ãƒ«</div><p class="desc">æ¨™æº–ä¿éšœé¡ã¨ä¿é™ºæ–™ã‚’å£²ä¸Šé«˜ã«æ›ç®—</p></div>
      </a>
      <a class="tile" data-tool="ccc" data-next="sales" target="_blank" rel="noopener">
        <div class="badge"><svg viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 9-9"/><path d="M3 3v6h6"/></svg></div>
        <div class="ttext"><div class="title">CCCè¨ˆç®—ãƒ„ãƒ¼ãƒ«</div><p class="desc">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚µã‚¤ã‚¯ãƒ«ã‚’è¨ˆç®—</p></div>
      </a>
    </div>
  </section>

  <footer class="mk-mini">
    Â© <span id="cpy-year">2025</span> <a href="https://www.matsumoto-kaikei.or.jp/" target="_blank" rel="noopener license">ç¨ç†å£«æ³•äººæ¾æœ¬ä¼šè¨ˆäº‹å‹™æ‰€</a> ï½œ
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="license noopener">CC BY-NC-SA 4.0</a> ï½œ
    <a href="/tool-portal/terms.html" target="_blank" rel="noopener">åˆ©ç”¨æ¡ä»¶</a> ï½œ
    <span id="build-rev">r65</span>ï¼ˆ<span id="last-updated-date"></span>ï¼‰
  </footer>

<script>
  (function(){
    const yEl = document.getElementById('cpy-year'); if (yEl) yEl.textContent = new Date().getFullYear();
    const updDate = document.getElementById('last-updated-date');
    if (updDate) { const d = new Date(document.lastModified); const p=n=>String(n).padStart(2,'0'); updDate.textContent = `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}`; }
  })();

  // ---- Tool routing params (for tool-side "Back to portal" nav) ----
  (function(){
    const PORTAL_HOME = 'https://takatrp.github.io/tool-portal/';
    const tools = {
      pl: 'https://takatrp.github.io/hendou_PL/',
      sales: 'https://takatrp.github.io/convert-to-sales/',
      price: 'https://takatrp.github.io/price-up-down/',
      labor: 'https://takatrp.github.io/time-unit-cost/',
      auto: 'https://takatrp.github.io/jidouka-kouka/',
      withholding: 'https://takatrp.github.io/withholding/',
      dep: 'https://takatrp.github.io/genkasyoukyaku/',
      insurance: 'https://takatrp.github.io/kigyoubouei/',
      ccc: 'https://takatrp.github.io/CCC/'
    };

    function buildToolUrl(toolKey, nextKey){
      const base = tools[toolKey];
      if(!base) return '#';
      const u = new URL(base);
      u.searchParams.set('from', 'tool-portal');
      u.searchParams.set('portal', PORTAL_HOME);
      if(nextKey && tools[nextKey]) u.searchParams.set('next', tools[nextKey]);
      return u.toString();
    }
    function buildToolUrlNoNext(toolKey){
      return buildToolUrl(toolKey, null);
    }

    function setFlow(urls, currentIndex){
      try{
        localStorage.setItem('mk_portal_url', PORTAL_HOME);
        localStorage.setItem('mk_flow', JSON.stringify(urls));
        localStorage.setItem('mk_flow_i', String(currentIndex||0));
      }catch(e){}
    }

    // data-tool ã‚’æŒã¤ãƒªãƒ³ã‚¯/ãƒãƒƒãƒ—/ãƒœã‚¿ãƒ³ã« href ã‚’ã‚»ãƒƒãƒˆ
    document.querySelectorAll('[data-tool]').forEach(el=>{
      const key = el.getAttribute('data-tool');
      const nextKey = el.getAttribute('data-next');
      const url = buildToolUrl(key, nextKey);

      if(el.tagName.toLowerCase() === 'a'){
        el.setAttribute('href', url);
      } else if(el.tagName.toLowerCase() === 'button'){
        el.addEventListener('click', ()=> window.open(url, '_blank', 'noopener'));
      }

      // ãƒãƒ¼ã‚¿ãƒ«URLã‚’ä¿å­˜ï¼ˆãƒ„ãƒ¼ãƒ«å´ãŒ portal ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª­ã‚ãªã„å ´åˆã®ä¿é™ºï¼‰
      el.addEventListener('click', ()=>{
        try{ localStorage.setItem('mk_portal_url', PORTAL_HOME); }catch(e){}

        // 2ã‚¹ãƒ†ãƒƒãƒ—å°ç·šï¼ˆdata-next ãŒã‚ã‚‹å ´åˆï¼‰ã‚’ flow ã¨ã—ã¦ä¿å­˜
        if(nextKey && tools[nextKey]){
          const flow = [buildToolUrlNoNext(key), buildToolUrlNoNext(nextKey)];
          setFlow(flow, 0);
        }
      }, {passive:true});
    });

    // 3åˆ†è¨ºæ–­ï¼šãƒ†ãƒ¼ãƒâ†’æ¨å¥¨ãƒ•ãƒ­ãƒ¼
    const flows = {
      price: { title:'å€¤ä¸Šã’ãƒ»ä¾¡æ ¼æ”¹å®š', steps:['price','pl'], note:'ä¾¡æ ¼æ”¹å®šã®å½±éŸ¿ã‚’è¦‹ãŸå¾Œã€åˆ©ç›Šæ§‹é€ ï¼ˆé™ç•Œåˆ©ç›Šï¼‰ã«è½ã¨ã—è¾¼ã¿ã¾ã™ã€‚' },
      cost:  { title:'æ”¯å‡ºãƒ»ã‚³ã‚¹ãƒˆã®å¦¥å½“æ€§', steps:['sales','pl'], note:'æ”¯å‡ºã®é‡ã•ã‚’ã€Œå¿…è¦å£²ä¸Šã€ã«ç½®ãæ›ãˆã€è…¹è½ã¡ã‚’ä½œã‚Šã¾ã™ã€‚' },
      labor: { title:'äººä»¶è²»ãƒ»æ¡ç”¨ãƒ»é…ç½®', steps:['labor','sales'], note:'æ™‚é–“å˜ä¾¡â†’å£²ä¸Šæ›ç®—ã®é †ã«è¦‹ã‚‹ã¨ã€ç¾å ´ã®åˆæ„å½¢æˆãŒé€Ÿã„ã§ã™ã€‚' },
      auto:  { title:'DXãƒ»è‡ªå‹•åŒ–æŠ•è³‡', steps:['auto','sales'], note:'å›åãƒ»ROIâ†’å¿…è¦å£²ä¸Šæ›ç®—ã¾ã§ç¹‹ã’ã‚‹ã¨ã€æ„æ€æ±ºå®šãŒãƒ–ãƒ¬ã¾ã›ã‚“ã€‚' },
      cash:  { title:'è³‡é‡‘ç¹°ã‚Šï¼ˆå›è»¢ï¼‰', steps:['ccc','sales'], note:'å›è»¢ï¼ˆé‹è»¢è³‡é‡‘ã®æºœã¾ã‚Šï¼‰ã‚’ç‰¹å®šã—ã¦ã‹ã‚‰ã€æ‰“ã¡æ‰‹ã®å„ªå…ˆé †ä½ã‚’ã¤ã‘ã¾ã™ã€‚' },
      tax:   { title:'ç¨å‹™ãƒ»å®Ÿå‹™ï¼ˆæ™‚çŸ­ï¼‰', steps:['withholding','dep'], note:'è¨ˆç®—ãƒ»å‡¦ç†ã®è¿·ã„ã‚’æ¸›ã‚‰ã—ã€ç¢ºèªæ™‚é–“ã‚’çŸ­ç¸®ã—ã¾ã™ã€‚' }
    };

    function chip(label, toolKey, nextKey, flowUrls, flowIndex){
      const a = document.createElement('a');
      a.className = 'chip';
      a.textContent = label;
      a.target = '_blank';
      a.rel = 'noopener';
      a.href = buildToolUrl(toolKey, nextKey);
      a.addEventListener('click', ()=>{
        try{
          localStorage.setItem('mk_portal_url', PORTAL_HOME);
          if(Array.isArray(flowUrls) && flowUrls.length){
            localStorage.setItem('mk_flow', JSON.stringify(flowUrls));
            localStorage.setItem('mk_flow_i', String(flowIndex||0));
          }
        }catch(e){}
      }, {passive:true});
      return a;
    }

    function toolLabel(k){
      return ({
        pl:'å¤‰å‹•æç›Š',
        sales:'å£²ä¸Šæ›ç®—',
        price:'ä¾¡æ ¼æ”¹å®š',
        labor:'äººä»¶è²»',
        auto:'è‡ªå‹•åŒ–åŠ¹æœ',
        ccc:'CCC',
        withholding:'æºæ³‰ãƒ»ä»•è¨³è£œåŠ©',
        dep:'æ¸›ä¾¡å„Ÿå´',
        insurance:'æ¨™æº–ä¿éšœé¡',
      })[k] || k;
    }

    const diagOpen = document.getElementById('diag-open');
    const diagModal = document.getElementById('diag-modal');
    const diagClose = document.getElementById('diag-close');
    const diagForm = document.getElementById('diag-form');
    const diagReset = document.getElementById('diag-reset');
    const diagResult = document.getElementById('diag-result');
    const diagSteps = document.getElementById('diag-steps');

    function openModal(m){ m?.classList.add('show'); }
    function closeModal(m){ m?.classList.remove('show'); }

    if(diagOpen && diagModal) diagOpen.addEventListener('click', ()=> openModal(diagModal));
    if(diagClose && diagModal) diagClose.addEventListener('click', ()=> closeModal(diagModal));
    if(diagModal) diagModal.addEventListener('click', (e)=>{ if(e.target === diagModal) closeModal(diagModal); });

    if(diagReset) diagReset.addEventListener('click', ()=>{
      diagResult.hidden = true;
      diagSteps.innerHTML = '';
      const first = diagForm?.querySelector('input[name="topic"]');
      if(first) first.checked = true;
    });

    if(diagForm) diagForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const topic = diagForm.querySelector('input[name="topic"]:checked')?.value || 'price';
      const flow = flows[topic] || flows.price;

      // flowUrls ã¯ã€Œnextç„¡ã—ã€ã®URLã‚’å…¨ã‚¹ãƒ†ãƒƒãƒ—åˆ†
      const flowUrls = (flow.steps || []).map(k => buildToolUrlNoNext(k));

      diagSteps.innerHTML = '';
      const steps = flow.steps;
      steps.forEach((k, idx)=>{
        const nextKey = steps[idx+1] || null;
        diagSteps.appendChild(chip(toolLabel(k), k, nextKey, flowUrls, idx));
        if(idx < steps.length - 1){
          const s = document.createElement('span');
          s.className = 'arrow';
          s.textContent = 'â†’';
          diagSteps.appendChild(s);
        }
      });

      // è¨ºæ–­çµæœã‚’è¦‹ãŸç›´å¾Œã€æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã‹ã‚‰é€²ã‚ã‚‹ã‚ˆã† flow ã‚’ä¿å­˜
      try{
        localStorage.setItem('mk_flow', JSON.stringify(flowUrls));
        localStorage.setItem('mk_flow_i', '0');
      }catch(e){}

      diagResult.hidden = false;
    });

    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ closeModal(diagModal); } });
  })();

  // QR modal open/close
  (function(){
    const modal = document.getElementById('qr-modal');
    const openBtn = document.getElementById('qr-open');
    const closeBtn = document.getElementById('qr-close');
    if (openBtn && modal) openBtn.addEventListener('click', ()=> modal.classList.add('show'));
    if (closeBtn && modal) closeBtn.addEventListener('click', ()=> modal.classList.remove('show'));
    if (modal) modal.addEventListener('click', (e)=>{ if(e.target === modal) modal.classList.remove('show'); });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') modal?.classList.remove('show'); });
  })();

  // A2HS modal open/close
  (function(){
    const modal = document.getElementById('a2hs-modal');
    const openBtn = document.getElementById('a2hs-open');
    const closeBtn = document.getElementById('a2hs-close');
    if (openBtn && modal) openBtn.addEventListener('click', ()=> modal.classList.add('show'));
    if (closeBtn && modal) closeBtn.addEventListener('click', ()=> modal.classList.remove('show'));
    if (modal) modal.addEventListener('click', (e)=>{ if(e.target === modal) modal.classList.remove('show'); });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') modal?.classList.remove('show'); });
  })();
</script>

<script>
  (function(){
    try{
      var img=document.querySelector('.branding img');
      if(img){
        img.onerror=function(){this.onerror=null;this.src='./ãƒ­ã‚´.png';};
        img.src='./ãƒ­ã‚´.jpg';
      }
    }catch(e){}
  })();
</script>

<!-- =============================================================
  å„ãƒ„ãƒ¼ãƒ«å´ï¼šä¸‹éƒ¨å›ºå®šãƒŠãƒ“ï¼ˆå…±é€šJSï¼‰

  1) tool-portal ãƒªãƒã‚¸ãƒˆãƒªã«ã€æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
     - /tool-portal/mk-nav.js

  2) å„ãƒ„ãƒ¼ãƒ«ï¼ˆhendou_PL / convert-to-sales / price-up-down ...ï¼‰ã® index.html ã® </body> ç›´å‰ã«
     æ¬¡ã®1è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

     <script src="https://takatrp.github.io/tool-portal/mk-nav.js" defer></script>

  ã“ã‚Œã§ã€ãƒ„ãƒ¼ãƒ«ç”»é¢ã®ä¸‹éƒ¨ã«ã€Œâ† ãƒãƒ¼ã‚¿ãƒ«ã€ã€Œæ¬¡ã¸ â†’ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
  - portal/next ã¯URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—
  - ã•ã‚‰ã«ã€ãƒãƒ¼ã‚¿ãƒ«å´ã§ localStorage ã« flow ã‚’ä¿å­˜ã—ã¦ã„ã‚‹ãŸã‚ã€æ¬¡ã¸ãƒœã‚¿ãƒ³ãŒ2ã€œè¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚‚æ©Ÿèƒ½ã—ã¾ã™
============================================================== -->

<!-- ===== mk-nav.jsï¼ˆã“ã®ã¾ã¾ mk-nav.js ã¨ã—ã¦ä¿å­˜ï¼‰ =====
(() => {
  const DEFAULT_PORTAL = 'https://takatrp.github.io/tool-portal/';

  // --- helpers ---
  const safeGet = (k) => { try { return localStorage.getItem(k); } catch (e) { return null; } };
  const safeSet = (k, v) => { try { localStorage.setItem(k, v); } catch (e) {} };
  const strip = (u) => {
    try {
      const x = new URL(u, location.href);
      return x.origin + x.pathname;
    } catch (e) {
      return u;
    }
  };
  const sameHostOk = (u) => {
    try {
      const x = new URL(u, location.href);
      // GitHub Pagesä¸Šã®æƒ³å®šï¼ˆå¿…è¦ãªã‚‰ matsumoto-kaikei.or.jp ãªã©è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ ï¼‰
      return x.hostname.endsWith('github.io');
    } catch (e) { return false; }
  };
  const withPortalParam = (u, portal) => {
    try {
      const x = new URL(u);
      x.searchParams.set('portal', portal);
      x.searchParams.set('from', 'tool-nav');
      return x.toString();
    } catch (e) {
      return u;
    }
  };

  // --- resolve portal ---
  const params = new URLSearchParams(location.search);
  let portal = params.get('portal') || safeGet('mk_portal_url') || DEFAULT_PORTAL;
  if (!portal.endsWith('/')) portal += '/';
  safeSet('mk_portal_url', portal);

  // --- resolve next ---
  // 1) URLã® next
  let next = params.get('next');

  // 2) localStorage ã® flowï¼ˆmk_flow: [url1,url2,...], mk_flow_i: indexï¼‰
  if (!next) {
    let flow = null;
    try { flow = JSON.parse(safeGet('mk_flow') || 'null'); } catch (e) { flow = null; }

    if (Array.isArray(flow) && flow.length) {
      const here = strip(location.href);
      let idx = -1;

      // a) ã¾ãšã¯ç¾åœ¨URLã«ä¸€è‡´ã™ã‚‹ index ã‚’æ¢ã™
      for (let i = 0; i < flow.length; i++) {
        if (strip(flow[i]) === here) { idx = i; break; }
      }

      // b) è¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã°ã€ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ index ã‚’æ¡ç”¨
      if (idx < 0) {
        const saved = parseInt(safeGet('mk_flow_i') || '0', 10);
        if (!Number.isNaN(saved)) idx = saved;
      }

      // c) æ¬¡ãŒã‚ã‚Œã°æç¤º
      if (idx >= 0 && idx < flow.length - 1) {
        next = flow[idx + 1];
        safeSet('mk_flow_i', String(idx));
      }
    }
  }

  // --- inject style ---
  const css = `
    :root{ --mk-brand:#578899; --mk-line:#e2e8f0; --mk-ink:#0f172a; --mk-muted:#64748b; }
    .mk-nav{position:fixed; left:0; right:0; bottom:0; z-index:999; padding:10px 12px calc(10px + env(safe-area-inset-bottom)); background:rgba(255,255,255,.92); border-top:1px solid var(--mk-line); backdrop-filter:saturate(180%) blur(10px);} 
    .mk-nav .inner{max-width:1100px; margin:0 auto; display:flex; gap:10px; align-items:center; justify-content:space-between;}
    .mk-nav .left{display:flex; flex-direction:column; gap:2px; min-width:0;}
    .mk-nav .brand{font-weight:900; color:var(--mk-ink); font-size:13px; line-height:1.2;}
    .mk-nav .hint{font-size:11px; color:var(--mk-muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; line-height:1.2;}
    .mk-nav .btns{display:flex; gap:8px; flex:0 0 auto;}
    .mk-nav a{display:inline-flex; align-items:center; justify-content:center; height:36px; padding:0 12px; border-radius:12px; border:1px solid var(--mk-line); text-decoration:none; font-weight:900; color:var(--mk-ink); background:#fff;}
    .mk-nav a.primary{border-color:transparent; background:linear-gradient(135deg, var(--mk-brand) 0%, #7aa5b4 100%); color:#fff;}
    .mk-nav a:active{transform:translateY(1px);} 
    @media (max-width:420px){ .mk-nav .hint{display:none;} .mk-nav a{height:34px; padding:0 10px; font-size:12px;} }
  `;
  const style = document.createElement('style');
  style.textContent = css;
  document.head.appendChild(style);

  // body bottom padding
  const pad = document.createElement('style');
  pad.textContent = `body{ padding-bottom: calc(62px + env(safe-area-inset-bottom)); }`;
  document.head.appendChild(pad);

  // --- build nav DOM ---
  const nav = document.createElement('div');
  nav.className = 'mk-nav';
  nav.setAttribute('role', 'navigation');
  nav.innerHTML = `
    <div class="inner">
      <div class="left">
        <div class="brand">æ¾æœ¬ä¼šè¨ˆãƒ„ãƒ¼ãƒ«</div>
        <div class="hint" id="mk-hint">ãƒãƒ¼ã‚¿ãƒ«ã¸æˆ»ã‚‹ï¼æ¬¡ã®ãŠã™ã™ã‚ã¸</div>
      </div>
      <div class="btns">
        <a href="${portal}" id="mk-back">â† ãƒãƒ¼ã‚¿ãƒ«</a>
        <a href="#" id="mk-next" class="primary" style="display:none;">æ¬¡ã¸ â†’</a>
      </div>
    </div>
  `;
  document.body.appendChild(nav);

  // --- wire next ---
  const nextBtn = nav.querySelector('#mk-next');
  if (next && sameHostOk(next)) {
    const nextUrl = withPortalParam(next, portal);
    nextBtn.href = nextUrl;
    nextBtn.style.display = '';

    nextBtn.addEventListener('click', () => {
      // flow ã® index ã‚’é€²ã‚ã‚‹ï¼ˆã‚ã‚Œã°ï¼‰
      try {
        const flow = JSON.parse(safeGet('mk_flow') || 'null');
        if (Array.isArray(flow) && flow.length) {
          const here = strip(location.href);
          let idx = -1;
          for (let i = 0; i < flow.length; i++) { if (strip(flow[i]) === here) { idx = i; break; } }
          if (idx >= 0) safeSet('mk_flow_i', String(Math.min(idx + 1, flow.length - 1)));
        }
      } catch (e) {}
    }, { passive: true });
  }

})();
===== /mk-nav.js ===== -->

<!--
<style>
  :root{ --mk-brand:#578899; --mk-line:#e2e8f0; --mk-ink:#0f172a; --mk-muted:#64748b; }
  .mk-nav{position:fixed; left:0; right:0; bottom:0; z-index:999; padding:10px 12px calc(10px + env(safe-area-inset-bottom)); background:rgba(255,255,255,.92); border-top:1px solid var(--mk-line); backdrop-filter:saturate(180%) blur(10px);} 
  .mk-nav .inner{max-width:1100px; margin:0 auto; display:flex; gap:10px; align-items:center; justify-content:space-between;}
  .mk-nav .left{display:flex; flex-direction:column; gap:2px; min-width:0;}
  .mk-nav .hint{font-size:11px; color:var(--mk-muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  .mk-nav .btns{display:flex; gap:8px; flex:0 0 auto;}
  .mk-nav a{display:inline-flex; align-items:center; justify-content:center; height:36px; padding:0 12px; border-radius:12px; border:1px solid var(--mk-line); text-decoration:none; font-weight:800; color:var(--mk-ink); background:#fff;}
  .mk-nav a.primary{border-color:transparent; background:linear-gradient(135deg, var(--mk-brand) 0%, #7aa5b4 100%); color:#fff;}
  @media (max-width:420px){
    .mk-nav .hint{display:none;}
    .mk-nav a{height:34px; padding:0 10px; font-size:12px;}
  }
  body{ padding-bottom: calc(62px + env(safe-area-inset-bottom)); }
</style>

<div class="mk-nav" id="mk-nav" hidden>
  <div class="inner">
    <div class="left">
      <div style="font-weight:900;">æ¾æœ¬ä¼šè¨ˆãƒ„ãƒ¼ãƒ«</div>
      <div class="hint" id="mk-hint">ãƒãƒ¼ã‚¿ãƒ«ã¸æˆ»ã‚‹ï¼æ¬¡ã®ãŠã™ã™ã‚ã¸</div>
    </div>
    <div class="btns">
      <a href="https://takatrp.github.io/tool-portal/" id="mk-back">â† ãƒãƒ¼ã‚¿ãƒ«</a>
      <a href="#" id="mk-next" class="primary" hidden>æ¬¡ã¸ â†’</a>
    </div>
  </div>
</div>

<script>
  (function(){
    const params = new URLSearchParams(location.search);
    const portal = params.get('portal') || (function(){ try{return localStorage.getItem('mk_portal_url');}catch(e){return null;} })() || 'https://takatrp.github.io/tool-portal/';
    const next = params.get('next');

    const nav = document.getElementById('mk-nav');
    const back = document.getElementById('mk-back');
    const nextBtn = document.getElementById('mk-next');

    if(back) back.href = portal;

    if(next){
      try{
        // nextã¯URLã¨ã—ã¦æ¥ã‚‹æƒ³å®šã€‚å®‰å…¨ã®ãŸã‚åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³ä»¥å¤–ã¯éè¡¨ç¤º
        const u = new URL(next);
        if(u.hostname.endsWith('github.io')){
          nextBtn.href = next;
          nextBtn.hidden = false;
        }
      }catch(e){}
    }

    // ä¿å­˜ï¼ˆæ¬¡å›ã®ä¿é™ºï¼‰
    try{ localStorage.setItem('mk_portal_url', portal); }catch(e){}

    if(nav) nav.hidden = false;
  })();
</script>
-->

</body>
</html>
